.row
  #content.col-md-9
    %h1#assignment-name.page-header{"assignment-id" => @assignment.id}
      = @assignment.name
      .menu-icon-container.hidden
        %span.glyphicon.glyphicon-tasks.menu-icon
    %p.bold Submission Instructions
    %p.italic
      Assignment for #{link_to @course.code + ": " + @course.name, course_path(@course.id)}
    - if @assignment.due_date
      %p
        .alert.alert-warning{:style => "font-weight: 600"}
          %span.glyphicon.glyphicon-time>
          Due at #{@assignment.due_date.strftime('%d/%m/%Y %I:%M%p')}
    %p= @assignment.description
    
    - if !@assignment.submissions.empty? && current_user.is_staff?
      - if @assignment.submissions.group("strftime('%Y%m%d %H', created_at)").length > 1
        .spinner#chart-spinner
          .double-bounce1
          .double-bounce2
        .charts
          .light.chart-title
            Submissions by hour for the past week
          %canvas#chart{width: "800", height: "200"}
          .light.chart-title
            Submissions by day
          %canvas#daily-chart{width: "800", height: "150"}
          .pie-charts
            .pie-chart
              .light.chart-title
                Submissions
              %canvas#submissions-chart{width: "150", height: "150"}
              .legend#submissions-chart-legend
            .pie-chart
              .light.chart-title
                Comments
              %canvas#comments-chart{width: "150", height: "150"}
              .legend#comments-chart-legend
      
      %h3 Submissions by group
      .spinner#groups-spinner
        .double-bounce1
        .double-bounce2
      %table.table.table-hover.table-striped#group-data
        %tr
          %th Group
          %th Tutor
          %th Finalised submissions
          %th Unique submissions

    - if current_user.is_admin_or_convenor?
      %h3 Extensions
      %table.table.table-hover.table-striped
        %tr
          %th Uni ID
          %th Name
          %th Extended Due Date
          %th Delete
        - for extension in @assignment.assignment_extensions
          %tr
            %td= link_to extension.user.uid, user_path(extension.user)
            %td= link_to extension.user.full_name, user_path(extension.user)
            %td= extension.due_date.strftime('%d/%m/%Y %I:%M%p')
            %td
              %a{"data-confirm" => "Are you sure you wish to delete this extension?", "data-method" => "delete", :href => "/assignment_extensions/#{extension.id}", :rel => "nofollow"}
                %span.glyphicon.glyphicon-trash
                Delete

    %h3 Your submissions
    %table.table.table-hover.table-striped
      - if @submissions.empty? && !current_user.is_staff?
        %p
        .alert.alert-danger{:style => "font-weight: 600"}
          %span.glyphicon.glyphicon-warning-sign
          %span You currently have no submissions for this assignment.
        %a{:href => "/submissions/#{@assignment.id.to_s}/new"} New submission
      - else
        %tr
          %th Submitted by
          %th Uni ID
          %th Date submitted
          %th
        - @submissions.each do |s|
          %tr
            %td= link_to s.user.full_name, user_path(s.user)
            %td= link_to s.user.uid, user_path(s.user)
            %td
              - if s.finalised
                = link_to submission_path(s), class: "good" do
                  %p
                    %span.glyphicon.glyphicon-thumbs-up
                    = s.created_at.strftime('%d/%m/%Y %I:%M%p')
                - if is_late_with_extension(s, @assignment)
                  .alert.alert-warning
                    %span.glyphicon.glyphicon-warning-sign
                    Your submission is late, but you have an extension granted until #{@assignment.latest_extension_for(s.user).due_date.strftime('%d/%m/%Y %I:%M%p')}
                - elsif is_late(s, @assignment) || is_late_without_extension(s, @assignment)
                  .alert.alert-danger
                    %span.glyphicon.glyphicon-warning-sign
                    Your submission is late. Unless you have been granted an exception your assignment may not be marked.
              - else
                = link_to submission_path(s) do
                  %p
                    %span.glyphicon.glyphicon-ok
                    = s.created_at.strftime('%d/%m/%Y %I:%M%p')
                - if is_late_with_extension(s, @assignment)
                  .alert.alert-warning
                    %span.glyphicon.glyphicon-warning-sign
                    Your submission is late, but you have an extension granted until #{@assignment.latest_extension_for(s.user).due_date.strftime('%d/%m/%Y %I:%M%p')}
                - elsif is_late(s, @assignment) || is_late_without_extension(s, @assignment)
                  .alert.alert-danger
                    %span.glyphicon.glyphicon-warning-sign
                    Your submission is late. Unless you have been granted an exception your assignment may not be marked.
            %td= link_to "View Submission", submission_path(s), class: "btn btn-sm btn-primary"
    - if current_user.is_staff?
      .tabs
        -# Tabs
        %ul.nav.nav-tabs#submission-tabs
          %li.active
            %a#allsubmissions-tab{href: "#allsubmissions", data:{toggle:"tab"}}
              All Submissions
          %li
            %a#finalsubmissions-tab{href: "#finalsubmissions", data:{toggle:"tab"}}
              Final Submissions
        .tab-content
          = render 'all_submissions'
          = render 'final_submissions'
  = render 'sidebar_show'

-# Chart
- if current_user.is_staff? && (params[:action] == "show" && params[:controller] == "assignments")
  = render 'chart_js'